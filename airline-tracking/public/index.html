<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL Injection Demo - Part C</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container mt-5">
        <h1 class="mb-5">SQL Injection Demo - Part C</h1>
        <form id="vulnerableSearchForm">
            <div class="form-group">
                <label for="flightCode">Flight Code</label>
                <input type="text" id="flightCode" class="form-control" placeholder="Enter Flight Code">
            </div>
            <div class="form-group">
                <label for="passengerLastName">Passenger Last Name</label>
                <input type="text" id="passengerLastName" class="form-control" placeholder="Enter Last Name">
            </div>
            <button type="submit" class="btn btn-primary">Search</button>
        </form>
        <hr>
        <h2 class="mt-5">Search Results</h2>
        <table class="table table-bordered" id="resultsTable">
            <thead>
                <tr>
                    <th>Flight Code</th>
                    <th>Seating Number</th>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Group Number</th>
                </tr>
            </thead>
            <tbody>
                <!-- Results will be populated here -->
            </tbody>
        </table>
    </div>

    <script>
        document.getElementById('vulnerableSearchForm').addEventListener('submit', async function (event) {
          event.preventDefault();
      
          const flightCode = document.getElementById('flightCode').value;
          const passengerLastName = document.getElementById('passengerLastName').value;
      
          try {
            const response = await fetch('/search-tickets-secure', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ flightCode, passengerLastName }),
            });
      
            const results = await response.json();
            const resultsTable = document.getElementById('resultsTable').querySelector('tbody');
            resultsTable.innerHTML = '';
      
            results.forEach(ticket => {
              const row = document.createElement('tr');
              row.innerHTML = `
                <td>${ticket.FlightCode}</td>
                <td>${ticket.SeatingNumber}</td>
                <td>${ticket.PassengerFirstName}</td>
                <td>${ticket.PassengerLastName}</td>
                <td>${ticket.GroupNumber}</td>
              `;
              resultsTable.appendChild(row);
            });
          } catch (error) {
            console.error('Error fetching search results:', error);
          }
        });
      </script>
      
</body>
</html>
